

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>lingtypology.maps &#8212; LingTypology 0.8.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LingTypology 0.8.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for lingtypology.maps</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;This module consist of classes and functions to draw linguistic interactive maps&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">import</span> <span class="nn">folium.plugins</span>

<span class="kn">import</span> <span class="nn">branca.colormap</span>
<span class="kn">import</span> <span class="nn">branca.element</span>

<span class="kn">import</span> <span class="nn">jinja2</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">colour</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">import</span> <span class="nn">lingtypology.glottolog</span>

<span class="n">MODULE_DIRECTORY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>

<div class="viewcode-block" id="LingMapError"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMapError">[docs]</a><span class="k">class</span> <span class="nc">LingMapError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;All special exceptions&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span></div>

<div class="viewcode-block" id="gradient"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.gradient">[docs]</a><span class="k">def</span> <span class="nf">gradient</span><span class="p">(</span><span class="n">iterations</span><span class="p">,</span> <span class="n">color1</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">color2</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Makes a color gradient</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    iterations: int</span>
<span class="sd">        Length of gradient.</span>
<span class="sd">    color1: str, default &#39;white&#39;</span>
<span class="sd">        First color.</span>
<span class="sd">    color2: str, default &#39;green&#39;</span>
<span class="sd">        Second color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">color1</span> <span class="o">=</span> <span class="n">colour</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="n">color1</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">()</span> \
            <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">color1</span><span class="o">.</span><span class="n">range_to</span><span class="p">(</span><span class="n">colour</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="n">color2</span><span class="p">),</span> <span class="n">iterations</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">colors</span></div>

<div class="viewcode-block" id="merge"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.merge">[docs]</a><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="o">*</span><span class="n">maps</span><span class="p">,</span> <span class="n">autoset_legends</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Merge several LingMap objects</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    *maps: list of LingMap</span>
<span class="sd">        List of LingMap objects.</span>
<span class="sd">    autoset_legends: bool, default True</span>
<span class="sd">        If set to True, legends will automatically move to free spaces</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">generate_new</span><span class="p">():</span>
        <span class="n">new_legend_position</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">legend_position</span> <span class="ow">in</span> <span class="n">legend_positions</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">legend_position</span> <span class="ow">in</span> <span class="n">occupied_legend_positions</span><span class="p">:</span>
                <span class="n">new_legend_position</span> <span class="o">=</span> <span class="n">legend_position</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">new_legend_position</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_legend_position</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;topright&#39;</span>
    <span class="n">legend_positions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;topright&#39;</span><span class="p">,</span> <span class="s1">&#39;topleft&#39;</span><span class="p">,</span> <span class="s1">&#39;bottomright&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;bottomleft&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">]</span>
    <span class="n">occupied_legend_positions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">legend_id</span> <span class="o">=</span> <span class="n">maps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_legend_id</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">maps</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span> <span class="o">==</span> <span class="n">maps</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">legend_id</span> <span class="o">+=</span> <span class="n">m</span><span class="o">.</span><span class="n">_legend_id</span>
            <span class="n">m</span><span class="o">.</span><span class="n">base_map</span> <span class="o">=</span> <span class="n">maps</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">create_map</span><span class="p">()</span>
            <span class="n">m</span><span class="o">.</span><span class="n">legend_id</span> <span class="o">=</span> <span class="n">legend_id</span>
        <span class="k">if</span> <span class="n">autoset_legends</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">legend_position</span> <span class="ow">in</span> <span class="n">occupied_legend_positions</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">legend_position</span> <span class="o">=</span> <span class="n">generate_new</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">stroke_legend_position</span> <span class="ow">in</span> <span class="n">occupied_legend_positions</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">stroke_legend_position</span> <span class="o">=</span> <span class="n">generate_new</span><span class="p">()</span>
            <span class="n">occupied_legend_positions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">legend_position</span><span class="p">)</span>
            <span class="n">occupied_legend_positions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">stroke_legend_position</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span></div>

<div class="viewcode-block" id="get_elevations"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.get_elevations">[docs]</a><span class="k">def</span> <span class="nf">get_elevations</span><span class="p">(</span><span class="n">languages</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get elevation data for list of languages&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">MODULE_DIRECTORY</span> <span class="o">+</span> <span class="s1">&#39;language_elevation_mapping.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">elevations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">not_okay</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">language</span> <span class="ow">in</span> <span class="n">languages</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">elevations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="n">language</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">elevations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">not_okay</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">not_okay</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Elevations for these languages were not found: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">not_okay</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">elevations</span></div>

<span class="k">def</span> <span class="nf">_frange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;range for floats&quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">start</span>
        <span class="n">start</span> <span class="o">+=</span> <span class="n">step</span>

<div class="viewcode-block" id="LingMap"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap">[docs]</a><span class="k">class</span> <span class="nc">LingMap</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Lingtypology map object</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    languages: list of strings, default []</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    Features:</span>
<span class="sd">    -------</span>
<span class="sd">    colors: list of html codes for colors</span>
<span class="sd">        Colors that represent features.</span>
<span class="sd">        You can either use the default colors or set yours.</span>
<span class="sd">    stroke_colors: list of html codes for colors</span>
<span class="sd">        Colors that represent additional (stroke) features.</span>
<span class="sd">        You can either use the default colors or set yours.</span>
<span class="sd">    shapes: list of characters</span>
<span class="sd">        If you use shapes instead of colors, you can either use the default shapes or set yours.</span>
<span class="sd">        Shapes are Unicode symbols.</span>
<span class="sd">    </span>
<span class="sd">    Map:</span>
<span class="sd">    -------</span>
<span class="sd">    tiles: str, default &#39;OpenStreetMap&#39;</span>
<span class="sd">        Tiles for the map. You can use one of these tiles:</span>
<span class="sd">            “OpenStreetMap”</span>
<span class="sd">            “Mapbox Bright” (Limited levels of zoom for free tiles)</span>
<span class="sd">            “Mapbox Control Room” (Limited levels of zoom for free tiles)</span>
<span class="sd">            “Stamen” (Terrain, Toner, and Watercolor)</span>
<span class="sd">            “Cloudmade” (Must pass API key)</span>
<span class="sd">            “Mapbox” (Must pass API key)</span>
<span class="sd">            “CartoDB” (positron and dark_matter)</span>
<span class="sd">        or pass the custum URL.</span>
<span class="sd">    base_map: folium.Map, default None</span>
<span class="sd">        In case you want to draw something on particular folium.Map.</span>
<span class="sd">    start_location: (float, float), default (0, 0)</span>
<span class="sd">        Coordinates of the map (latitude, longitude).</span>
<span class="sd">    start_zoom: int, default 2</span>
<span class="sd">        Imitial zoom level.</span>
<span class="sd">    control_scale: bool, default True</span>
<span class="sd">        Whether to add control scale.</span>
<span class="sd">    prefer_canvas: bool, default False</span>
<span class="sd">        Use canvas instead of SVG.</span>
<span class="sd">        If set to True, the map may be more responsive in case you have a lot of markers.</span>
<span class="sd">    title: str, default None</span>
<span class="sd">        You can add a title to the map.</span>
<span class="sd">    start_location_mapping: dict,</span>
<span class="sd">        Mapping between normal locations and coordinates.</span>

<span class="sd">    Legend:</span>
<span class="sd">    -------</span>
<span class="sd">    legend: bool, default True</span>
<span class="sd">        Whether to add legend</span>
<span class="sd">    stroke_legend: bool True</span>
<span class="sd">        Whether to add stroke legend</span>
<span class="sd">    legend_title: str, default Legend</span>
<span class="sd">        Legend title</span>
<span class="sd">    stroke_legend_title: str, default Legend</span>
<span class="sd">        Stroke legend title</span>
<span class="sd">    legend_position: str, default &#39;bottomright&#39;</span>
<span class="sd">        Legend position.</span>
<span class="sd">        Available values: &#39;right&#39;, &#39;left&#39;, &#39;top&#39;, &#39;bottom&#39;, &#39;bottomright&#39;, &#39;bottomleft&#39;, &#39;topright&#39;, &#39;topleft&#39;</span>
<span class="sd">    stroke_legend_position: str, default &#39;bottomleft&#39;</span>
<span class="sd">        Stroke legend position.</span>
<span class="sd">        Available values: &#39;right&#39;, &#39;left&#39;, &#39;top&#39;, &#39;bottom&#39;, &#39;bottomright&#39;, &#39;bottomleft&#39;, &#39;topright&#39;, &#39;topleft&#39;</span>

<span class="sd">    Markers:</span>
<span class="sd">    -------</span>
<span class="sd">    use_shapes: bool, default False</span>
<span class="sd">        Whether to use shapes instead of colors.</span>
<span class="sd">    radius: int, default 7</span>
<span class="sd">        Circle marker radius.</span>
<span class="sd">    stroke_radius: int, default 12</span>
<span class="sd">        Radius of markers if you use stroke features.</span>
<span class="sd">    stroked: bool, default True</span>
<span class="sd">        Whether to add stroke to markers.</span>
<span class="sd">    unstroked: bool, default True</span>
<span class="sd">        If set to True, circle marker will merge if you zoom out without stroke between them.</span>
<span class="sd">        It multiplies the number of markers by 2. For better performance set it to False.</span>
<span class="sd">        To understand how it looks see the example below.</span>

<span class="sd">        unstroked = True (default):</span>
<span class="sd">             ┌——————————┐</span>
<span class="sd">             │ ▒▒▒▒▒▒▒▒ │</span>
<span class="sd">             │ ▒▒▒▒▒▒▒▒ └—————┐</span>
<span class="sd">             │ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒ │</span>
<span class="sd">             │ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒ │</span>
<span class="sd">             └—————┐ ▒▒▒▒▒▒▒▒ │</span>
<span class="sd">                   │ ▒▒▒▒▒▒▒▒ │</span>
<span class="sd">                   └——————————┘</span>
<span class="sd">        unstroked = False:</span>
<span class="sd">             ┌——————————┐</span>
<span class="sd">             │ ▒▒▒▒▒▒▒▒ │</span>
<span class="sd">             │ ▒▒▒▒▒┌———┴——————┐</span>
<span class="sd">             │ ▒▒▒▒▒│ ▒▒▒▒▒▒▒▒ │</span>
<span class="sd">             │ ▒▒▒▒▒│ ▒▒▒▒▒▒▒▒ │</span>
<span class="sd">             └——————┤ ▒▒▒▒▒▒▒▒ │</span>
<span class="sd">                    │ ▒▒▒▒▒▒▒▒ │</span>
<span class="sd">                    └——————————┘</span>

<span class="sd">    Popups:</span>
<span class="sd">    -------</span>
<span class="sd">    languages_in_popups: bool, default True</span>
<span class="sd">        Whether to show links to Glottolog website in popups</span>
<span class="sd">    html_popups: bool, default False</span>
<span class="sd">        Setting it to True allows to put full html pages into popups (using folium.IFrame).</span>

<span class="sd">    Control:</span>
<span class="sd">    -------</span>
<span class="sd">    control: bool, default False</span>
<span class="sd">        Whether to add LayerControls and group by features.</span>
<span class="sd">    stroke_control: bool, default False</span>
<span class="sd">        Whether to add LayerControls and group by stroke features.</span>
<span class="sd">    control_position: str, default &#39;topright&#39;</span>
<span class="sd">        Position of LayerControls.</span>
<span class="sd">        May be ‘topleft’, ‘topright’, ‘bottomleft’ or ‘bottomright’.</span>

<span class="sd">    Other:</span>
<span class="sd">    -------</span>
<span class="sd">    heatmap_only: bool, default False</span>
<span class="sd">        If set to true no markers will be rendered.</span>
<span class="sd">    colormap_colors: tuple, default (&#39;white&#39;,&#39;green&#39;)</span>
<span class="sd">        Default colors for the colormap.</span>
<span class="sd">    minicharts: list, defaule []</span>
<span class="sd">        List of folium.DivIcon for minicharts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">languages</span><span class="o">=</span><span class="p">[],</span> <span class="n">glottocode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__</span>

<span class="sd">        Sets self.languages turning it into a tuple.</span>
<span class="sd">        If no languages are given, sets self.heatmap_only to true.</span>
<span class="sd">        If glottocode is True, languages will not be converted to glottocodes</span>
<span class="sd">        Then it sets everything else.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">languages</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">languages</span> <span class="o">=</span> <span class="p">(</span><span class="n">languages</span><span class="p">,)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">languages</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">languages</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">languages</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">languages</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">languages</span> <span class="o">=</span> <span class="n">languages</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_only</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_only</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glottocode</span> <span class="o">=</span> <span class="n">glottocode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warnings_enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Feature representation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_colors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="s1">&#39;#000000&#39;</span><span class="p">,</span> <span class="s1">&#39;#800000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#BC8F8F&#39;</span><span class="p">,</span> <span class="s1">&#39;#FFE4C4&#39;</span><span class="p">,</span> <span class="s1">&#39;#6495ED&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#4682B4&#39;</span><span class="p">,</span> <span class="s1">&#39;#FF6347&#39;</span><span class="p">,</span> <span class="s1">&#39;#778899&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#40E0D0&#39;</span><span class="p">,</span> <span class="s1">&#39;#00FFFF&#39;</span><span class="p">,</span> <span class="s1">&#39;#F08080&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#6495ED&#39;</span><span class="p">,</span> <span class="s1">&#39;#FF7F50&#39;</span><span class="p">,</span> <span class="s1">&#39;#D2691E&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#7FFF00&#39;</span><span class="p">,</span> <span class="s1">&#39;#5F9EA0&#39;</span><span class="p">,</span> <span class="s1">&#39;#DEB887&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#A52A2A&#39;</span><span class="p">,</span> <span class="s1">&#39;#8A2BE2&#39;</span><span class="p">,</span> <span class="s1">&#39;#0000FF&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;#e6194b&#39;</span><span class="p">,</span> <span class="s1">&#39;#19e6b4&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffe119&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#4363d8&#39;</span><span class="p">,</span> <span class="s1">&#39;#f58231&#39;</span><span class="p">,</span> <span class="s1">&#39;#911eb4&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#46f0f0&#39;</span><span class="p">,</span> <span class="s1">&#39;#f032e6&#39;</span><span class="p">,</span> <span class="s1">&#39;#bcf60c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#fabebe&#39;</span><span class="p">,</span> <span class="s1">&#39;#008080&#39;</span><span class="p">,</span> <span class="s1">&#39;#e6beff&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#9a6324&#39;</span><span class="p">,</span> <span class="s1">&#39;#fffac8&#39;</span><span class="p">,</span> <span class="s1">&#39;#800000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#aaffc3&#39;</span><span class="p">,</span> <span class="s1">&#39;#808000&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffd8b1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#000075&#39;</span><span class="p">,</span> <span class="s1">&#39;#808080&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;⬤&#39;</span><span class="p">,</span> <span class="s1">&#39;◼&#39;</span><span class="p">,</span> <span class="s1">&#39;▲&#39;</span><span class="p">,</span> <span class="s1">&#39;◯&#39;</span><span class="p">,</span> <span class="s1">&#39;◻&#39;</span><span class="p">,</span> <span class="s1">&#39;△&#39;</span><span class="p">,</span> <span class="s1">&#39;◉&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;▣&#39;</span><span class="p">,</span> <span class="s1">&#39;◐&#39;</span><span class="p">,</span> <span class="s1">&#39;◧&#39;</span><span class="p">,</span> <span class="s1">&#39;◭&#39;</span><span class="p">,</span> <span class="s1">&#39;◍&#39;</span><span class="p">,</span><span class="s1">&#39;▤&#39;</span><span class="p">,</span> <span class="s1">&#39;▶&#39;</span><span class="p">]</span>
        <span class="c1"># Map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span> <span class="o">=</span> <span class="s1">&#39;OpenStreetMap&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;the most important attr&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_location</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_zoom</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_scale</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefer_canvas</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Legend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_legend</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_title</span> <span class="o">=</span> <span class="s1">&#39;Legend&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_legend_title</span> <span class="o">=</span> <span class="s1">&#39;Legend&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_position</span> <span class="o">=</span> <span class="s1">&#39;bottomright&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_legend_position</span> <span class="o">=</span> <span class="s1">&#39;topright&#39;</span>
        <span class="c1"># Popups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">languages_in_popups</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_popups</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Markers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_shapes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_radius</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroked</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unstroked</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_control</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_position</span> <span class="o">=</span> <span class="s1">&#39;topright&#39;</span>
        <span class="c1"># Colormap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numeric</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_numeric</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colormap_colors</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_colormap_colors</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="c1"># Heat map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_heatmap</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Adding other stuff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rectangles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#Don&#39;t touch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_legend_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popups</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_coordinates</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_features</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_location_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Central Europe&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start_location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;start_zoom&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
            <span class="s1">&#39;Caucasus&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start_location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">42</span><span class="p">),</span> <span class="s1">&#39;start_zoom&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
            <span class="s1">&#39;Australia &amp; Oceania&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start_location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="mi">159</span><span class="p">),</span> <span class="s1">&#39;start_zoom&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
            <span class="s1">&#39;Papua New Guinea&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start_location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">141</span><span class="p">),</span> <span class="s1">&#39;start_zoom&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
            <span class="s1">&#39;Africa&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start_location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">22</span><span class="p">),</span> <span class="s1">&#39;start_zoom&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
            <span class="s1">&#39;Asia&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start_location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="s1">&#39;start_zoom&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
            <span class="s1">&#39;North America&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start_location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="o">-</span><span class="mi">102</span><span class="p">),</span> <span class="s1">&#39;start_zoom&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
            <span class="s1">&#39;Central America&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start_location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="o">-</span><span class="mi">81</span><span class="p">),</span> <span class="s1">&#39;start_zoom&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
            <span class="s1">&#39;South America&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start_location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">27</span><span class="p">,</span> <span class="o">-</span><span class="mi">49</span><span class="p">),</span> <span class="s1">&#39;start_zoom&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minicharts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minichart_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marker_groups</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">_check_and_generate_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks whether amount of some unique features is larger that the amount of colors&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
            <span class="n">features</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">colors</span> <span class="o">&lt;</span> <span class="n">features</span><span class="p">:</span>
                <span class="n">new_colors</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s1">&#39;#</span><span class="si">{:06x}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span> \
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">features</span><span class="o">-</span><span class="n">colors</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">+=</span> <span class="n">new_colors</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_features</span><span class="p">:</span>
            <span class="n">stroke_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stroke_colors</span><span class="p">)</span>
            <span class="n">stroke_features</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stroke_features</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">stroke_colors</span> <span class="o">&lt;</span> <span class="n">stroke_features</span><span class="p">:</span>
                <span class="n">new_colors</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s1">&#39;#</span><span class="si">{:06x}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span> \
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stroke_features</span><span class="o">-</span><span class="n">stroke_colors</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stroke_colors</span> <span class="o">+=</span> <span class="n">new_colors</span>
        
    <span class="k">def</span> <span class="nf">_get_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get coordinates either from:</span>
<span class="sd">            self.custom_coordinates or</span>
<span class="sd">            self.languages as language names or</span>
<span class="sd">            self.languages as glottocode.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        language: str</span>
<span class="sd">            Either language name or glottocode.</span>
<span class="sd">        i: int</span>
<span class="sd">            Iteration of the cicle.</span>
<span class="sd">        </span>
<span class="sd">        Returns: tuple of two ints (coordinates).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_coordinates</span><span class="p">:</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">glottocode</span><span class="p">:</span>
                <span class="n">coordinates</span> <span class="o">=</span> \
                    <span class="n">lingtypology</span><span class="o">.</span><span class="n">glottolog</span><span class="o">.</span><span class="n">get_coordinates_by_glot_id</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">coordinates</span> <span class="o">=</span> \
                    <span class="n">lingtypology</span><span class="o">.</span><span class="n">glottolog</span><span class="o">.</span><span class="n">get_coordinates</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">coordinates</span> \
            <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> \
            <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">coordinates</span>

    <span class="k">def</span> <span class="nf">_create_popups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">parse_html</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates popups.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        marker: folium.CircleMarker</span>
<span class="sd">            Marker to add the popup to.</span>
<span class="sd">        language: str</span>
<span class="sd">            Language name.</span>
<span class="sd">        i: int</span>
<span class="sd">            Number of the marker.</span>
<span class="sd">        parse_html: bool, default False</span>
<span class="sd">            Whether to use Folium.IFrame to add content to the popup</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">popup_href</span> <span class="o">=</span> \
            <span class="s1">&#39;&lt;a &#39;</span> \
                <span class="s1">&#39;href=&quot;https://glottolog.org/resource/languoid/id/</span><span class="si">{}</span><span class="s1">&quot; &#39;</span> \
                <span class="sd">&#39;&#39;&#39;onclick=&quot;this.target=&#39;_blank&#39;;&quot;&#39;&#39;&#39;</span> \
            <span class="s1">&#39;&gt;&#39;</span> \
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;&lt;/a&gt;&#39;</span>\
            <span class="s1">&#39;&lt;br&gt;&#39;</span>
        <span class="n">href_link</span> <span class="o">=</span> <span class="n">lingtypology</span><span class="o">.</span><span class="n">glottolog</span><span class="o">.</span><span class="n">get_glot_id</span><span class="p">(</span><span class="n">language</span><span class="p">)</span> \
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">glottocode</span> \
            <span class="k">else</span> <span class="n">language</span>
        <span class="n">href_content</span> <span class="o">=</span> <span class="n">language</span> \
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">glottocode</span> \
            <span class="k">else</span> <span class="n">lingtypology</span><span class="o">.</span><span class="n">glottolog</span><span class="o">.</span><span class="n">get_by_glot_id</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
        <span class="n">popup_href</span> <span class="o">=</span> <span class="n">popup_href</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">href_link</span><span class="p">,</span> <span class="n">href_content</span><span class="p">)</span> \
            <span class="k">if</span> <span class="n">href_link</span> \
            <span class="k">else</span> <span class="n">href_content</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">languages_in_popups</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">popups</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parse_html</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">LingMapError</span><span class="p">(</span>
                        <span class="s1">&#39;It is impossible to add both language links&#39;</span> \
                        <span class="s1">&#39;and large HTML strings.</span><span class="se">\n</span><span class="s1">&#39;</span> \
                        <span class="s1">&#39;You can either not use html_popups option &#39;</span> \
                        <span class="s1">&#39;or set ling_map_object.languages_in_popups = False.&#39;</span>
                    <span class="p">)</span>
                <span class="n">popup</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="n">popup_href</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">popups</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">popup</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="n">popup_href</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">popups</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parse_html</span><span class="p">:</span>
                    <span class="n">iframe</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">IFrame</span><span class="p">(</span><span class="n">html</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">popups</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">popup</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="n">iframe</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">popup</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">popups</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">popup</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_legend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">legend_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Legend&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;bottomright&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates legend and adds it to the map</span>

<span class="sd">        m: folium.Map</span>
<span class="sd">            The map.</span>
<span class="sd">        legend_data: str</span>
<span class="sd">            Html string with the contents for the legend.</span>
<span class="sd">        title: str, default &#39;Legend&#39;</span>
<span class="sd">            Legend title.</span>
<span class="sd">        position: str, default &#39;bottomright&#39;</span>
<span class="sd">            Legend position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">MODULE_DIRECTORY</span> <span class="o">+</span> <span class="s1">&#39;legend.html&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">legend_data</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">use_shapes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_shapes</span><span class="p">,</span> <span class="n">legend_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_legend_id</span>
        <span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;{% macro html(this, kwargs) %}&#39;</span> <span class="o">+</span> <span class="n">template</span> <span class="o">+</span> <span class="s1">&#39;{</span><span class="si">% e</span><span class="s1">ndmacro %}&#39;</span>
        <span class="n">macro</span> <span class="o">=</span> <span class="n">branca</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">MacroElement</span><span class="p">()</span>
        <span class="n">macro</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">branca</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">macro</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_legend_id</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_create_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">heatmap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates heatmap and adds it to the map</span>

<span class="sd">        m: folium.Map</span>
<span class="sd">            The map.</span>
<span class="sd">        heatmap: list</span>
<span class="sd">            List of coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folium</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">HeatMap</span><span class="p">(</span><span class="n">heatmap</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates title and adds it to the map</span>

<span class="sd">        m: folium.Map</span>
<span class="sd">            The map.</span>
<span class="sd">        title: str</span>
<span class="sd">            Title.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">MODULE_DIRECTORY</span> <span class="o">+</span> <span class="s1">&#39;legend.html&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                                   <span class="n">legend_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_legend_id</span><span class="p">,</span> <span class="n">it_is_title</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;{% macro html(this, kwargs) %}&#39;</span> <span class="o">+</span> <span class="n">template</span> <span class="o">+</span> <span class="s1">&#39;{</span><span class="si">% e</span><span class="s1">ndmacro %}&#39;</span>
        <span class="n">macro</span> <span class="o">=</span> <span class="n">branca</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">MacroElement</span><span class="p">()</span>
        <span class="n">macro</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">branca</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">macro</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_legend_id</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_set_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">location</span><span class="p">,</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
                    <span class="n">fill</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">stroke</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">fill_opacity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                    <span class="n">fill_color</span> <span class="o">=</span> <span class="s1">&#39;#DEB887&#39;</span><span class="p">,</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets marker</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        location: list</span>
<span class="sd">            List of coordinates.</span>
<span class="sd">        radius: int, default 7,</span>
<span class="sd">        fill: bool, default True,</span>
<span class="sd">        stroke: bool, default False,</span>
<span class="sd">        weight: int, default 1,</span>
<span class="sd">        fill_opacity: float, default 1,</span>
<span class="sd">        color: str, default &#39;#000000&#39;,</span>
<span class="sd">        fill_color: str, default &#39;#DEB887&#39;,</span>
<span class="sd">        shape: str, default &#39;&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        marker: folium.CircleMarker</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">shape</span><span class="p">:</span>
            <span class="n">div</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">DivIcon</span><span class="p">(</span>
                <span class="n">html</span><span class="o">=</span><span class="s1">&#39;&lt;div style=&quot;font-size: 170%&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">div</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">CircleMarker</span><span class="p">(</span>
                <span class="n">location</span> <span class="o">=</span> <span class="n">location</span><span class="p">,</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="p">,</span>
                <span class="n">fill</span> <span class="o">=</span> <span class="n">fill</span><span class="p">,</span>
                <span class="n">stroke</span> <span class="o">=</span> <span class="n">stroke</span><span class="p">,</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span><span class="p">,</span>
                <span class="n">fill_opacity</span> <span class="o">=</span> <span class="n">fill_opacity</span><span class="p">,</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span>
                <span class="n">fill_color</span> <span class="o">=</span> <span class="n">fill_color</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">marker</span>

    
    <span class="k">def</span> <span class="nf">_sort_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This crazy function is needed to sort everything by features for the colormap</span>

<span class="sd">        It takes all necessary attributes and sorts them by features.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features: str</span>
<span class="sd">            List of features</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        features: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">languages</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">popups</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">tooltips</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_coordinates</span><span class="p">]</span>
        <span class="n">length</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
        <span class="n">attrs_r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr</span><span class="p">:</span>
                <span class="n">attrs_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attrs_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="o">*</span><span class="n">attrs_r</span><span class="p">))</span>
            <span class="n">al</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1">#In case of different types, fall back to sorting as str</span>
            <span class="n">al</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">features</span><span class="p">),</span> <span class="o">*</span><span class="n">attrs_r</span><span class="p">))</span>
            <span class="n">al</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">languages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">al</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">languages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">popups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tooltips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">custom_coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
        <span class="k">return</span> <span class="n">features</span>
    
    <span class="k">def</span> <span class="nf">_make_colormap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">colormap_colors</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">round_up</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">digits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">a</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span> <span class="o">-</span> <span class="n">digits</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">round_down</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">digits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">a</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span> <span class="o">-</span> <span class="n">digits</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">how_round</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">10000</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">4</span>
            <span class="k">elif</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">3</span>
            <span class="k">elif</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">2</span>
            <span class="k">elif</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="kc">None</span>
            
        <span class="c1">#Round features so that they look handsome</span>
        <span class="n">digits</span> <span class="o">=</span> <span class="n">how_round</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">round_down</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">digits</span><span class="p">)</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">round_up</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">digits</span><span class="p">)</span>
        
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">branca</span><span class="o">.</span><span class="n">colormap</span><span class="o">.</span><span class="n">LinearColormap</span><span class="p">(</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colormap_colors</span><span class="p">,</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">],</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">minimum</span><span class="p">,</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">maximum</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">features</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">colormap_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">maximum</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">maximum</span> <span class="o">//</span> <span class="mi">10</span>
                <span class="n">colormap_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">step</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">maximum</span> <span class="o">/</span> <span class="mi">10</span>
            <span class="n">colormap_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_frange</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">step</span><span class="p">))</span>

        <span class="c1"># Crazy stuff below draws SVGs with color gradient</span>
        <span class="n">groups_features</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">colormap</span><span class="p">(</span><span class="n">feature</span><span class="p">))</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
        <span class="n">color_data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">cf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colormap_features</span><span class="p">):</span>
            <span class="n">color_data</span> <span class="o">+=</span> <span class="s1">&#39;&lt;line x1=&quot;0&quot; y1=&quot;</span><span class="si">{pos}</span><span class="s1">&quot; x2=&quot;20&quot; y2=&quot;</span><span class="si">{pos}</span><span class="s1">&quot;&#39;</span> \
                <span class="s1">&#39;style=&quot;stroke:</span><span class="si">{color}</span><span class="s1">;stroke-width:3;&quot; /&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">pos</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colormap</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;&lt;text x=&quot;5&quot; y=&quot;</span><span class="si">{pos}</span><span class="s1">&quot; dx=&quot;0&quot; dy=&quot;0ex&quot;&gt;- </span><span class="si">{text}</span><span class="s1">&lt;/text&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">pos</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">cf</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">colormap_features</span><span class="p">):</span>
                <span class="n">gr</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">colormap</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> \
                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">_frange</span><span class="p">(</span>
                            <span class="n">cf</span><span class="p">,</span> <span class="n">colormap_features</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">step</span> <span class="o">/</span> <span class="mi">20</span>
                        <span class="p">)</span>
                <span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">gr</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">color_data</span> <span class="o">+=</span> <span class="s1">&#39;&lt;line x1=&quot;0&quot; y1=&quot;</span><span class="si">{pos}</span><span class="s1">&quot; x2=&quot;20&quot; y2=&quot;</span><span class="si">{pos}</span><span class="s1">&quot;&#39;</span> \
                        <span class="s1">&#39;style=&quot;stroke:</span><span class="si">{color}</span><span class="s1">;stroke-width:3;&quot; /&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">pos</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span>
                        <span class="p">)</span>
        
        <span class="n">gradient_templ</span> <span class="o">=</span> <span class="s1">&#39;&lt;svg height=&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; width=&quot;20&quot;&gt;</span><span class="si">{}</span><span class="s1">&lt;/svg&gt;&#39;</span>
        <span class="n">text_templ</span> <span class="o">=</span> <span class="s1">&#39;&lt;svg height=&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; width=&quot;50&quot;&gt;</span><span class="si">{}</span><span class="s1">&lt;/svg&gt;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> \
            <span class="n">gradient_templ</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">color_data</span><span class="p">)</span> <span class="o">+</span> \
            <span class="n">text_templ</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">groups_features</span>

    <span class="k">def</span> <span class="nf">_prepare_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">stroke</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates data for legend (depending on type of features) and creates features groups if needed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features: list of strings</span>
<span class="sd">            Features or stroke features.</span>
<span class="sd">        stroke: bool, default False</span>
<span class="sd">            Defines whether there are stroke features or not.</span>
<span class="sd">        use_shapes: bool, default False</span>
<span class="sd">            Whether to use shapes instead of colors.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        groups_features: tuple:</span>
<span class="sd">            folium.map.FeatureGroup or 0</span>
<span class="sd">                Feature group for the feature or 0 if it is not needed.</span>
<span class="sd">            str</span>
<span class="sd">                Color or shape.</span>
<span class="sd">        data: str</span>
<span class="sd">            HTML string of data for legend.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">use_shapes</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span>
        <span class="k">elif</span> <span class="n">stroke</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_colors</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span>
            
        <span class="n">numeric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_numeric</span> <span class="k">if</span> <span class="n">stroke</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">numeric</span>
        <span class="n">colormap_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_colormap_colors</span> \
            <span class="k">if</span> <span class="n">stroke</span> \
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">colormap_colors</span>
            
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_all</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numeric</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">features</span><span class="p">):</span>
                        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">features</span><span class="p">):</span>
                        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">groups_features</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_make_colormap</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">colormap_colors</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">clear_features</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">clear_features</span><span class="p">:</span>
                    <span class="n">clear_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
                    <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clear_features</span><span class="p">):</span>
                <span class="n">mapping</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">feature</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">groups_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
            <span class="n">html</span> <span class="o">=</span> \
                <span class="s1">&#39;&lt;li&gt;&#39;</span> \
                    <span class="s1">&#39;&lt;span &#39;</span> \
                        <span class="s1">&#39;style=&quot;&#39;</span> \
                            <span class="s1">&#39;color: #000000; &#39;</span> \
                            <span class="s1">&#39;text-align: center; &#39;</span> \
                            <span class="s1">&#39;opacity:0.7; &#39;</span> \
                        <span class="s1">&#39;&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> \
                            <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span> \
                    <span class="s1">&#39;&lt;/span&gt;&#39;</span> \
                        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span> \
                <span class="s1">&#39;&lt;/li&gt;&#39;</span> \
                    <span class="k">if</span> <span class="n">use_shapes</span> \
                    <span class="k">else</span> \
                        <span class="s1">&#39;&lt;li&gt;&lt;span &#39;</span> \
                            <span class="s1">&#39;style=&quot;background: </span><span class="si">{}</span><span class="s1">;opacity:0.7;&quot;&#39;</span> \
                        <span class="s1">&#39;&gt;&lt;/span&gt;</span><span class="si">{}</span><span class="s1">&lt;/li&gt;&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">html</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">groups_features</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_unified_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">color_shape</span><span class="p">,</span> <span class="n">s_color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates several (&lt;5, &gt;0) markers that will look like one.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinates: tuple</span>
<span class="sd">            Tuple of (latitude, longitude).</span>
<span class="sd">        color_shape: str</span>
<span class="sd">            Color OR shape.</span>
<span class="sd">        s_color:</span>
<span class="sd">            Stroke color. It is not used if there are no stroke features.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        dict:</span>
<span class="sd">            &#39;marker&#39;: folium.CircleMarker</span>
<span class="sd">                Base marker.</span>

<span class="sd">                ▒▒▒▒▒</span>
<span class="sd">                ▒▒▒▒▒</span>
<span class="sd">                ▒▒▒▒▒</span>
<span class="sd">                </span>
<span class="sd">            &#39;stroke&#39;: folium.CircleMarker</span>
<span class="sd">                Marker that will look like stroke for the base marker.</span>
<span class="sd">                </span>
<span class="sd">               ┌———————┐</span>
<span class="sd">               │ ▒▒▒▒▒ │</span>
<span class="sd">               │ ▒▒▒▒▒ │</span>
<span class="sd">               │ ▒▒▒▒▒ │</span>
<span class="sd">               └———————┘</span>
<span class="sd">                </span>
<span class="sd">            &#39;s_marker&#39;: folium.CircleMarker</span>
<span class="sd">                Base marker for stroke features, it will look like big stroke.</span>
<span class="sd">                </span>
<span class="sd">              ▓▓▓▓▓▓▓▓▓▓▓▓▓</span>
<span class="sd">              ▓ ┌———————┐ ▓</span>
<span class="sd">              ▓ │ ▒▒▒▒▒ │ ▓</span>
<span class="sd">              ▓ │ ▒▒▒▒▒ │ ▓</span>
<span class="sd">              ▓ │ ▒▒▒▒▒ │ ▓</span>
<span class="sd">              ▓ └———————┘ ▓</span>
<span class="sd">              ▓▓▓▓▓▓▓▓▓▓▓▓▓</span>
<span class="sd">              </span>
<span class="sd">            &#39;s_stroke&#39;: folium.CircleMarker</span>
<span class="sd">                Marker that will look like stroke for s_marker.</span>

<span class="sd">             ┌———————————————┐</span>
<span class="sd">             │ ▓▓▓▓▓▓▓▓▓▓▓▓▓ │</span>
<span class="sd">             │ ▓ ┌———————┐ ▓ │</span>
<span class="sd">             │ ▓ │ ▒▒▒▒▒ │ ▓ │</span>
<span class="sd">             │ ▓ │ ▒▒▒▒▒ │ ▓ │</span>
<span class="sd">             │ ▓ │ ▒▒▒▒▒ │ ▓ │</span>
<span class="sd">             │ ▓ └———————┘ ▓ │</span>
<span class="sd">             │ ▓▓▓▓▓▓▓▓▓▓▓▓▓ │</span>
<span class="sd">             └———————————————┘  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">stroke</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">s_marker</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">s_stroke</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_features</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unstroked</span><span class="p">:</span>
                <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span>
                    <span class="n">fill_opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span><span class="p">,</span>
                    <span class="n">fill_color</span> <span class="o">=</span> <span class="n">color_shape</span>
                <span class="p">)</span>
                <span class="n">stroke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">stroke</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">,</span>
                    <span class="n">fill_opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span><span class="p">,</span>
                    <span class="n">fill_color</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span>
                <span class="p">)</span>
                <span class="n">s_marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_radius</span><span class="p">,</span>
                    <span class="n">fill_opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_opacity</span><span class="p">,</span>
                    <span class="n">fill_color</span> <span class="o">=</span> <span class="n">s_color</span>
                <span class="p">)</span>
                <span class="n">s_stroke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">stroke</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_radius</span> <span class="o">*</span> <span class="mf">1.12</span><span class="p">,</span>
                    <span class="n">fill_opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_opacity</span><span class="p">,</span>
                    <span class="n">fill_color</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">stroke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroked</span><span class="p">,</span>
                    <span class="n">fill_opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span><span class="p">,</span>
                    <span class="n">fill_color</span> <span class="o">=</span> <span class="n">color_shape</span>
                <span class="p">)</span>
                <span class="n">s_marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">stroke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroked</span><span class="p">,</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_radius</span><span class="p">,</span>
                    <span class="n">fill_opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_opacity</span><span class="p">,</span>
                    <span class="n">fill_color</span> <span class="o">=</span> <span class="n">s_color</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_shapes</span><span class="p">:</span>
                <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">fill_color</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                    <span class="n">fill_opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span><span class="p">,</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">color_shape</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unstroked</span><span class="p">:</span>
                    <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span>
                        <span class="n">fill_opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span><span class="p">,</span>
                        <span class="n">fill_color</span> <span class="o">=</span> <span class="n">color_shape</span>
                    <span class="p">)</span>
                    <span class="n">stroke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="n">stroke</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">,</span>
                        <span class="n">fill_opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span><span class="p">,</span>
                        <span class="n">fill_color</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="n">stroke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroked</span><span class="p">,</span>
                        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span>
                        <span class="n">fill_opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span><span class="p">,</span>
                        <span class="n">fill_color</span> <span class="o">=</span> <span class="n">color_shape</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="n">marker</span><span class="p">,</span> <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="n">stroke</span><span class="p">,</span>
                <span class="s1">&#39;s_marker&#39;</span><span class="p">:</span> <span class="n">s_marker</span><span class="p">,</span> <span class="s1">&#39;s_stroke&#39;</span><span class="p">:</span> <span class="n">s_stroke</span><span class="p">}</span>

<div class="viewcode-block" id="LingMap.add_features"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.add_features">[docs]</a>    <span class="k">def</span> <span class="nf">add_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">numeric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add features</span>

<span class="sd">        features: list of strings</span>
<span class="sd">            List of features. Length of the list should equal to length of languages.</span>
<span class="sd">            By default, if you add features, a legend will appear. To shut it down set</span>
<span class="sd">            &quot;legend&quot; attribute to False.</span>
<span class="sd">            To change the title of the legend use &quot;legend_title&quot; attribute.</span>
<span class="sd">        radius: int, default 7</span>
<span class="sd">            Marker radius.</span>
<span class="sd">        opacity: float, default 1</span>
<span class="sd">            Marker opacity: a number between 0(invisible) and 1(not transparent).</span>
<span class="sd">        colors: list of html codes for colors (str), default None</span>
<span class="sd">            Colors that represent features. You can either use the 20 default</span>
<span class="sd">            colors(if None) or set yours(else).</span>
<span class="sd">        numeric: bool, default False</span>
<span class="sd">            Whether to assign different color to each feature (False),</span>
<span class="sd">            or to assign a color from colormap (True).</span>
<span class="sd">            You can set it to True only in case your features are numeric,</span>
<span class="sd">            for example &quot;Number of phonemes&quot;, and stroke features are not given.</span>
<span class="sd">        control: bool, default False</span>
<span class="sd">            Whether to add LayerControls to the map.</span>
<span class="sd">            It allows interactive turning on/off given features.</span>
<span class="sd">        use_shapes: bool, default False</span>
<span class="sd">            Whether to use shapes instead of colors. This option allows to represent features as shapes.</span>
<span class="sd">            Shapes are Unicode charaters like ⬤ or ◼. You can replace or add to default symbols by</span>
<span class="sd">            changing attribute &quot;shapes&quot;.</span>
<span class="sd">            If colors are not a viable option for you, you can set this option to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sanity_check</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">feature_name</span><span class="o">=</span><span class="s1">&#39;features&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="n">opacity</span>
        <span class="k">if</span> <span class="n">colors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">numeric</span> <span class="o">=</span> <span class="n">numeric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_shapes</span> <span class="o">=</span> <span class="n">use_shapes</span></div>

<div class="viewcode-block" id="LingMap.add_stroke_features"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.add_stroke_features">[docs]</a>    <span class="k">def</span> <span class="nf">add_stroke_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numeric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add stroke features</span>

<span class="sd">        This function assigns features to strokes of markers.</span>
<span class="sd">        </span>
<span class="sd">        features: list of strings</span>
<span class="sd">            List of features. Length of the list should equal to length of languages.</span>
<span class="sd">            By default, if you add features, a legend will appear. To shut it down set</span>
<span class="sd">            &quot;stroke_legend&quot; attribute to False.</span>
<span class="sd">            To change the title of the legend use &quot;stroke_legend_title&quot; attribute.</span>
<span class="sd">        opacity: float, default 1</span>
<span class="sd">            Marker opacity: a number between 0(invisible) and 1(not transparent).</span>
<span class="sd">        colors: list of html codes for colors (str), default None</span>
<span class="sd">            Colors that represent stroke features. You can either use the 20 default</span>
<span class="sd">            colors(if None) or set yours(else).</span>
<span class="sd">        radius: int, default 12</span>
<span class="sd">            Marker radius.31</span>
<span class="sd">        control: bool, default False</span>
<span class="sd">            Whether to add LayerControls to the map.</span>
<span class="sd">            It allows interactive turning on/off given features.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sanity_check</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">feature_name</span><span class="o">=</span><span class="s1">&#39;stroke features&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_features</span> <span class="o">=</span> <span class="n">features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_opacity</span> <span class="o">=</span> <span class="n">opacity</span>
        <span class="k">if</span> <span class="n">colors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stroke_colors</span> <span class="o">=</span> <span class="n">colors</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">s_numeric</span> <span class="o">=</span> <span class="n">numeric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_control</span> <span class="o">=</span> <span class="n">control</span></div>
        

<div class="viewcode-block" id="LingMap.add_popups"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.add_popups">[docs]</a>    <span class="k">def</span> <span class="nf">add_popups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">popups</span><span class="p">,</span> <span class="n">parse_html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">glottolog_links</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add popups to markers</span>

<span class="sd">        popups: list of strings</span>
<span class="sd">            List of popups. Length of the list should equal to length of languages.</span>
<span class="sd">        parse_html: bool, default False</span>
<span class="sd">            By default (False) you can add small pieces of html code.</span>
<span class="sd">            If you need to add full html pages to popups, you need to set the option to True.</span>
<span class="sd">        glottolog_links: bool, default True</span>
<span class="sd">            Whether to include links to Glottolog in popups.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">popups</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">popups</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sanity_check</span><span class="p">(</span><span class="n">popups</span><span class="p">,</span> <span class="n">feature_name</span><span class="o">=</span><span class="s1">&#39;popups&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popups</span> <span class="o">=</span> <span class="n">popups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_popups</span> <span class="o">=</span> <span class="n">parse_html</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">languages_in_popups</span> <span class="o">=</span> <span class="n">glottolog_links</span> \
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parse_html</span> <span class="k">else</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="LingMap.add_tooltips"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.add_tooltips">[docs]</a>    <span class="k">def</span> <span class="nf">add_tooltips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tooltips</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add tooltips to markers</span>

<span class="sd">        tooltips: list of strings</span>
<span class="sd">            List of tooltips. Length of the list should equal to length of languages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tooltips</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tooltips</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sanity_check</span><span class="p">(</span><span class="n">tooltips</span><span class="p">,</span> <span class="n">feature_name</span><span class="o">=</span><span class="s1">&#39;tooltips&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="n">tooltips</span></div>

<div class="viewcode-block" id="LingMap.add_custom_coordinates"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.add_custom_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">add_custom_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">custom_coordinates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set custom coordinates</span>

<span class="sd">        By default coordinates for the languages are taken from the Glottolog database.</span>
<span class="sd">        If you have coordinates and want to use them, use this function.</span>
<span class="sd">        </span>
<span class="sd">        custom_coordinates: list of custom_coordinates (tuples)</span>
<span class="sd">            Length of the list should equal to length of languages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">custom_coordinates</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">custom_coordinates</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sanity_check</span><span class="p">(</span><span class="n">custom_coordinates</span><span class="p">,</span> <span class="n">feature_name</span><span class="o">=</span><span class="s1">&#39;custom_coordinates&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_coordinates</span> <span class="o">=</span> <span class="n">custom_coordinates</span></div>

<div class="viewcode-block" id="LingMap.add_minimap"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.add_minimap">[docs]</a>    <span class="k">def</span> <span class="nf">add_minimap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;bottomleft&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
                    <span class="n">collapsed_width</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">collapsed_height</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">zoom_animation</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add minimap</span>

<span class="sd">        position: str, default &#39;bottomleft&#39;</span>
<span class="sd">        width: int, default 150</span>
<span class="sd">        height: int, default 150</span>
<span class="sd">        collapsed_width: int, default 25</span>
<span class="sd">        collapsed_height: int, default 25</span>
<span class="sd">        zoom_animation: bool, default True</span>
<span class="sd">            You can disable zoom animation for better performance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
            <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="n">height</span><span class="p">,</span>
            <span class="s1">&#39;collapsed_width&#39;</span><span class="p">:</span> <span class="n">collapsed_width</span><span class="p">,</span>
            <span class="s1">&#39;collapsed_height&#39;</span><span class="p">:</span> <span class="n">collapsed_height</span><span class="p">,</span>
            <span class="s1">&#39;zoom_animation&#39;</span><span class="p">:</span> <span class="n">zoom_animation</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="LingMap.add_rectangle"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.add_rectangle">[docs]</a>    <span class="k">def</span> <span class="nf">add_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">popup</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add one rectangle</span>

<span class="sd">        To add several rectangles, use this function several times.</span>

<span class="sd">        locations: list of two tuples</span>
<span class="sd">            Coordinates of two points to draw a rectangle.</span>
<span class="sd">        tooltip: str, default &#39;&#39;</span>
<span class="sd">        popups: str, default &#39;&#39;</span>
<span class="sd">        color: str, default &#39;black&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rectangles</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="n">locations</span><span class="p">,</span> <span class="s1">&#39;tooltip&#39;</span><span class="p">:</span> <span class="n">tooltip</span><span class="p">,</span>
                                <span class="s1">&#39;popup&#39;</span><span class="p">:</span> <span class="n">popup</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">})</span></div>

<div class="viewcode-block" id="LingMap.add_line"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.add_line">[docs]</a>    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">popup</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">smooth_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add one line</span>

<span class="sd">        To add several lines, use this function several times.</span>

<span class="sd">        locations: list of two tuples</span>
<span class="sd">            Coordinates of two points to draw a line.</span>
<span class="sd">        tooltip: str, default &#39;&#39;</span>
<span class="sd">        popups: str, default &#39;&#39;</span>
<span class="sd">        color: str, default &#39;black&#39;</span>
<span class="sd">        smooth_factor: float, default 1.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;locations&#39;</span><span class="p">:</span> <span class="n">locations</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
                <span class="s1">&#39;smooth_factor&#39;</span><span class="p">:</span> <span class="n">smooth_factor</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">tooltip</span><span class="p">:</span>
            <span class="n">line</span><span class="p">[</span><span class="s1">&#39;tooltip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tooltip</span>
        <span class="k">if</span> <span class="n">popup</span><span class="p">:</span>
            <span class="n">line</span><span class="p">[</span><span class="s1">&#39;popup&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">popup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<div class="viewcode-block" id="LingMap.add_heatmap"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.add_heatmap">[docs]</a>    <span class="k">def</span> <span class="nf">add_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heatmap</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Add heatmap</span>

<span class="sd">        heatmap: list of tuples</span>
<span class="sd">            Coordinates for the heatmap.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_heatmap</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">heatmap</span><span class="p">)</span></div>

<div class="viewcode-block" id="LingMap.add_minicharts"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.add_minicharts">[docs]</a>    <span class="k">def</span> <span class="nf">add_minicharts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">minicharts</span><span class="p">,</span>
                       <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;pie&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                       <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">textprops</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                       <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bar_width</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create minicharts using maplotlib</span>
<span class="sd">        </span>
<span class="sd">        How it works:</span>
<span class="sd">        * Draw plots using matplotlib.</span>
<span class="sd">        * Save it as SVG but catch the stream.</span>
<span class="sd">        * Create markers with SVG DivIcon.</span>
<span class="sd">        * Create popups with data from the plots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">minichart</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="k">for</span> <span class="n">minichart</span> <span class="ow">in</span> <span class="n">minicharts</span><span class="p">):</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">serie</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">serie</span> <span class="ow">in</span> <span class="n">minicharts</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">LingMapError</span><span class="p">(</span><span class="s1">&#39;You shound either pass names or use pandas.Series&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minichart_names</span> <span class="o">=</span> <span class="n">names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minicharts_data</span> <span class="o">=</span> <span class="n">minicharts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popups</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;pie&#39;</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LingMapError</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: unknown type of chart.</span><span class="se">\n</span><span class="s1">&#39;</span> \
                <span class="s1">&#39;You can use either &quot;pie&quot; or &quot;bar&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span>
            <span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">minichart</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">minicharts</span><span class="p">)):</span>
            <span class="n">sizes</span> <span class="o">=</span> <span class="n">minichart</span>
            <span class="k">if</span> <span class="n">colors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;pie&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span>
                        <span class="n">sizes</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="n">startangle</span><span class="p">,</span>
                        <span class="n">textprops</span><span class="o">=</span><span class="n">textprops</span><span class="p">,</span>
                        <span class="n">labels</span><span class="o">=</span><span class="n">sizes</span><span class="p">,</span>
                        <span class="n">labeldistance</span><span class="o">=</span><span class="mf">0.2</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="n">startangle</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minichart_names</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">sizes</span><span class="p">,</span>
                       <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">bar_width</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="n">buff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;SVG&#39;</span><span class="p">)</span>
            <span class="n">buff</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>

            <span class="n">svg</span> <span class="o">=</span> <span class="n">buff</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;height=&quot;(.*?)pt&quot;&#39;</span><span class="p">,</span> <span class="n">svg</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;width=&quot;(.*?)pt&quot;&#39;</span><span class="p">,</span> <span class="n">svg</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="c1">#This is magic</span>
            <span class="n">center</span> <span class="o">=</span> <span class="p">((</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mf">1.31</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mf">1.31</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">minicharts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">folium</span><span class="o">.</span><span class="n">DivIcon</span><span class="p">(</span><span class="n">html</span><span class="o">=</span><span class="n">svg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">icon_anchor</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">minichart</span><span class="p">):</span>
                <span class="n">popup</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&lt;br&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">popups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">popup</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="LingMap.add_overlapping_features"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.add_overlapping_features">[docs]</a>    <span class="k">def</span> <span class="nf">add_overlapping_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker_groups</span><span class="p">,</span>
                                 <span class="n">radius</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">radius_increment</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                 <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add overlapping features</span>
<span class="sd">        </span>
<span class="sd">        For example, if you want to draw on map whether language &#39;is ergative&#39;, &#39;is slavic&#39;, &#39;is spoken in Russia&#39;.</span>
<span class="sd">        It will draw several markers of different size for each location.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        features: list of lists</span>
<span class="sd">            List of features. Amount of features should be equal to the</span>
<span class="sd">            amount of languages.</span>
<span class="sd">        radius: int, default 7</span>
<span class="sd">            Radius of the smallest circle.</span>
<span class="sd">        radius_increment: int, default 4</span>
<span class="sd">            Step by which the size of the marker for each feature will be</span>
<span class="sd">            incremented.</span>
<span class="sd">        colors: list of html codes for colors (str), default None</span>
<span class="sd">            Colors that represent features. You can either use the 20 default</span>
<span class="sd">            colors(if *None*) or set yours(else).</span>
<span class="sd">        mapping: dict, default None</span>
<span class="sd">            Mapping for the legend.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marker_groups</span> <span class="o">=</span> <span class="n">marker_groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius_increment</span> <span class="o">=</span> <span class="n">radius_increment</span>
        <span class="k">if</span> <span class="n">colors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_mapping</span> <span class="o">=</span> <span class="n">mapping</span></div>

    <span class="k">def</span> <span class="nf">_sanity_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">feature_name</span><span class="o">=</span><span class="s1">&#39;corresponding lists&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if length of features, popups and tooltips is equal to the length of languages</span>

<span class="sd">        features: list</span>
<span class="sd">        feature_name: str, default &#39;corresponding list&#39;</span>
<span class="sd">            feature_name is what will appear in the exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">languages</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">LingMapError</span><span class="p">(</span>
                <span class="s1">&#39;Length of languages and &#39;</span> \
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> does not match&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature_name</span><span class="p">))</span>
    
<div class="viewcode-block" id="LingMap.create_map"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.create_map">[docs]</a>    <span class="k">def</span> <span class="nf">create_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw the map</span>

<span class="sd">        Gets all necessary attributes and draws everything on the map.</span>
<span class="sd">        </span>
<span class="sd">        How it works:</span>
<span class="sd">        * Set up start location and zoom if start_location is passed as shortcut.</span>
<span class="sd">        * Create folium.Map object using [self.start_location, zoom_start=self.start_zoom,</span>
<span class="sd">            control_scale=self.control_scale, prefer_canvas=self.prefer_canvas]</span>
<span class="sd">        * Create default_group (folium.FeatureGroup)</span>
<span class="sd">        * Declare lists: markers, strokes, s_markers, s_strokes</span>
<span class="sd">        * Check whether minimap, rectangles, lines and title are here and draw them.</span>
<span class="sd">        * If the user sets self.heatmap_only to True, draw it and return the map.</span>
<span class="sd">            {{ first ending }}</span>
<span class="sd">        * If user passes minicharts:</span>
<span class="sd">            * Walk in self.languages:</span>
<span class="sd">                * Apply custom coordinates or the ones from Glottolog.</span>
<span class="sd">                * Set folium.Marker with plot SVG as folium.DivIcon</span>
<span class="sd">                * Create popups with links to Glottolog (if necessary) and</span>
<span class="sd">                    data from plots.</span>
<span class="sd">                * Draw the logend using names from plots and colors.</span>
<span class="sd">                * Return the map.</span>
<span class="sd">            {{ second ending }}</span>
<span class="sd">        * If user passes overlapping_features (LingMap().marker_groups):</span>
<span class="sd">            * If color_mapping is not given, make it.</span>
<span class="sd">            * Walk in languages:</span>
<span class="sd">                * Get coordinates if not given.</span>
<span class="sd">                * Set markers, popups and tooltips.</span>
<span class="sd">            * Create legend.</span>
<span class="sd">            {{ third ending }}</span>
<span class="sd">        * If features are given, prepare them (_prepare_features). This includes:</span>
<span class="sd">            * Creating folium.FeatureGroup.</span>
<span class="sd">            * Creating data for legend.</span>
<span class="sd">            * Storing info on features as list of tuples (len = 2)</span>
<span class="sd">                * The first element: color (HEX) of shape (Unicode)</span>
<span class="sd">                * The second element: folium.FeatureGroup</span>
<span class="sd">        * If stroke features are given, prepare them as well.</span>
<span class="sd">        * Walk in languages:</span>
<span class="sd">            * Apply custom coordinates or the ones from Glottolog.</span>
<span class="sd">            * Create unified marker using:</span>
<span class="sd">                coordinates, color/shape for features and color for stroke features.</span>
<span class="sd">                Unified marker is a dict that consists of information necessary</span>
<span class="sd">                to draw 1-4 markers (more look in docstring for _create_unified_marker.</span>
<span class="sd">            * Create popup for the marker (_create_popups method).</span>
<span class="sd">            * Create tooltips.</span>
<span class="sd">            * Append the unified_marker to the the folium.FeatureGroup.</span>
<span class="sd">        * If features are numeric:</span>
<span class="sd">            * Add them to the default FeatureGroup.</span>
<span class="sd">            * Draw the legend (_create_legend).</span>
<span class="sd">        * If not:</span>
<span class="sd">            * Add them to proper FeatureGroups.</span>
<span class="sd">            * If LayerControl if asked for, draw it.</span>
<span class="sd">            * Draw the legend (_create_legend).</span>
<span class="sd">        * If heatmap is asked for, draw it (_create_heatmap).</span>
<span class="sd">        * Return the map.</span>
<span class="sd">        {{true ending}}</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        m: folium.Map</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_and_generate_colors</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_location</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_location</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_location_mapping</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">LingMapError</span><span class="p">(</span>
                    <span class="s1">&#39;No such start location shortcut. Try passing coordinates.&#39;</span>
                <span class="p">)</span>
            <span class="n">mapped_location_and_zoom</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">start_location_mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_location</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_location</span> <span class="o">=</span> \
                <span class="n">mapped_location_and_zoom</span><span class="p">[</span><span class="s1">&#39;start_location&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_zoom</span> <span class="o">=</span> \
                <span class="n">mapped_location_and_zoom</span><span class="p">[</span><span class="s1">&#39;start_zoom&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_map</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_map</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span>
                <span class="n">location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_location</span><span class="p">,</span>
                <span class="n">zoom_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_zoom</span><span class="p">,</span>
                <span class="n">control_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_scale</span><span class="p">,</span>
                <span class="n">prefer_canvas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prefer_canvas</span><span class="p">,</span>
                <span class="n">tiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tiles</span>
            <span class="p">)</span>

        <span class="n">default_group</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">()</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">strokes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">s_markers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">s_strokes</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimap</span><span class="p">:</span>
            <span class="n">minimap</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">MiniMap</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">minimap</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">minimap</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rectangles</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rectangle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rectangles</span><span class="p">:</span>
                <span class="n">folium</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="o">**</span><span class="n">rectangle</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
                <span class="n">folium</span><span class="o">.</span><span class="n">PolyLine</span><span class="p">(</span><span class="o">**</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_title</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_only</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_heatmap</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span><span class="p">)</span>
            <span class="c1">#If we don&#39;t draw markers, we&#39;re done here</span>
            <span class="k">return</span> <span class="n">m</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minicharts</span><span class="p">:</span>
            <span class="c1">#we&#39;ll draw minicharts separately</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">language</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">languages</span><span class="p">):</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coordinates</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">coordinates</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">marker</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minicharts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_create_popups</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
                                    <span class="n">parse_html</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">html_popups</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltips</span><span class="p">:</span>
                    <span class="n">tooltip</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltips</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">tooltip</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minichart_names</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">legend</span><span class="p">:</span>
                <span class="n">legend_data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minichart_names</span><span class="p">)):</span>
                    <span class="n">legend_data</span> <span class="o">+=</span> \
                        <span class="s1">&#39;&lt;li&gt;&#39;</span> \
                            <span class="s1">&#39;&lt;span style=&quot;background: </span><span class="si">{}</span><span class="s1">;opacity:0.7;&quot;&gt;&#39;</span> \
                            <span class="s1">&#39;&lt;/span&gt;&#39;</span> \
                            <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span> \
                        <span class="s1">&#39;&lt;/li&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">minichart_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_legend</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">legend_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_title</span><span class="p">,</span>
                                    <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_position</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">m</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">marker_groups</span><span class="p">:</span>
            <span class="c1">#Separately too</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_mapping</span><span class="p">:</span>
                <span class="n">color_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_mapping</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color_mapping</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">mark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">marker_groups</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">mark</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">color_mapping</span><span class="p">:</span>
                            <span class="n">color_mapping</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">language</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">languages</span><span class="p">):</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coordinates</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">coordinates</span><span class="p">:</span>
                    <span class="k">continue</span>
                
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">marker_groups</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">marker_groups</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius_increment</span>
                
                <span class="k">for</span> <span class="n">marker_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">marker_groups</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">(</span>
                        <span class="n">coordinates</span><span class="p">,</span> <span class="n">stroke</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stroked</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                        <span class="n">fill_opacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">opacity</span><span class="p">,</span>
                        <span class="n">fill_color</span><span class="o">=</span><span class="n">color_mapping</span><span class="p">[</span><span class="n">marker_data</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">radius</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius_increment</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltips</span><span class="p">:</span>
                        <span class="n">tooltip</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltips</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">tooltip</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_create_popups</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
                                        <span class="n">parse_html</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">html_popups</span><span class="p">)</span>
                    <span class="n">markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>

            <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">,</span> <span class="n">markers</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legend</span><span class="p">:</span>
                <span class="n">legend_data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">color_mapping</span><span class="p">:</span>
                    <span class="n">legend_data</span> <span class="o">+=</span> \
                        <span class="s1">&#39;&lt;li&gt;&#39;</span> \
                            <span class="s1">&#39;&lt;span style=&quot;background: </span><span class="si">{}</span><span class="s1">;opacity:0.7;&quot;&gt;&#39;</span> \
                            <span class="s1">&#39;&lt;/span&gt;&#39;</span> \
                            <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span> \
                        <span class="s1">&#39;&lt;/li&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">color_mapping</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="n">feature</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_legend</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">legend_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_title</span><span class="p">,</span>
                                    <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_position</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">m</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="n">prepared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_features</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">use_shapes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_shapes</span>
            <span class="p">)</span>
            <span class="n">groups_features</span> <span class="o">=</span> <span class="n">prepared</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">prepared</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_features</span><span class="p">:</span>
            <span class="n">prepared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_features</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stroke_features</span><span class="p">,</span> <span class="n">stroke</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_shapes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_shapes</span>
            <span class="p">)</span>
            <span class="n">s_groups_features</span> <span class="o">=</span> <span class="n">prepared</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s_data</span> <span class="o">=</span> <span class="n">prepared</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">language</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">languages</span><span class="p">):</span>
            <span class="n">stroke_marker</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coordinates</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">coordinates</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
            
            <span class="n">color_shape</span> <span class="o">=</span> <span class="n">groups_features</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> \
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> \
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="n">s_color</span> <span class="o">=</span> <span class="n">s_groups_features</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> \
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_features</span> \
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                
            <span class="n">unified_marker</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_unified_marker</span><span class="p">(</span>
                    <span class="n">coordinates</span><span class="p">,</span> <span class="n">color_shape</span><span class="p">,</span> <span class="n">s_color</span>
                <span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_popups</span><span class="p">(</span>
                <span class="n">unified_marker</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">],</span> <span class="n">language</span><span class="p">,</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">parse_html</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">html_popups</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">numeric</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">groups_features</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_features</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_control</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">s_groups_features</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">default_group</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltips</span><span class="p">:</span>
                <span class="n">tooltip</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltips</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">tooltip</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">unified_marker</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">])</span>

            <span class="n">markers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">unified_marker</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">],</span> <span class="n">group</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">unified_marker</span><span class="p">[</span><span class="s1">&#39;stroke&#39;</span><span class="p">]:</span>
                <span class="n">strokes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">unified_marker</span><span class="p">[</span><span class="s1">&#39;stroke&#39;</span><span class="p">],</span> <span class="n">group</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">unified_marker</span><span class="p">[</span><span class="s1">&#39;s_marker&#39;</span><span class="p">]:</span>
                <span class="n">s_markers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">unified_marker</span><span class="p">[</span><span class="s1">&#39;s_marker&#39;</span><span class="p">],</span> <span class="n">group</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">unified_marker</span><span class="p">[</span><span class="s1">&#39;s_stroke&#39;</span><span class="p">]:</span>
                <span class="n">s_strokes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">unified_marker</span><span class="p">[</span><span class="s1">&#39;s_stroke&#39;</span><span class="p">],</span> <span class="n">group</span><span class="p">))</span>

        <span class="c1">#This order is important</span>
        <span class="k">if</span> <span class="n">s_strokes</span><span class="p">:</span>
            <span class="n">collection</span><span class="o">.</span><span class="n">deque</span><span class="p">((</span><span class="n">s_stroke</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">s_stroke</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">s_stroke</span> <span class="ow">in</span> <span class="n">s_strokes</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">s_markers</span><span class="p">:</span>
            <span class="n">collection</span><span class="o">.</span><span class="n">deque</span><span class="p">((</span><span class="n">s_mark</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">s_mark</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">s_mark</span> <span class="ow">in</span> <span class="n">s_markers</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">strokes</span><span class="p">:</span>
            <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">((</span><span class="n">stroke</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">stroke</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">stroke</span> <span class="ow">in</span> <span class="n">strokes</span><span class="p">))</span>
        <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">((</span><span class="n">mark</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">mark</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">mark</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numeric</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_numeric</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">default_group</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numeric</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_create_legend</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_title</span><span class="p">,</span>
                                        <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_position</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_numeric</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_create_legend</span><span class="p">(</span>
                        <span class="n">m</span><span class="p">,</span> <span class="n">s_data</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stroke_legend_title</span><span class="p">,</span>
                        <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stroke_legend_position</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">:</span>
                    <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">((</span><span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">fg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="n">groups_features</span><span class="p">))</span>
                    <span class="n">folium</span><span class="o">.</span><span class="n">LayerControl</span><span class="p">(</span>
                        <span class="n">collapsed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_position</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_control</span><span class="p">:</span>
                    <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">((</span><span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">fg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="n">s_groups_features</span><span class="p">))</span>
                    <span class="n">folium</span><span class="o">.</span><span class="n">LayerControl</span><span class="p">(</span>
                        <span class="n">collapsed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_position</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">default_group</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legend</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_create_legend</span><span class="p">(</span>
                        <span class="n">m</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_title</span><span class="p">,</span>
                        <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_position</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_features</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_legend</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_create_legend</span><span class="p">(</span>
                        <span class="n">m</span><span class="p">,</span> <span class="n">s_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stroke_legend_title</span><span class="p">,</span>
                        <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stroke_legend_position</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">default_group</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_heatmap</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_heatmap</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lingtypology</span><span class="o">.</span><span class="n">glottolog</span><span class="o">.</span><span class="n">warnings</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">warnings_enabled</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;(get_coordinates) &#39;</span>
                <span class="s1">&#39;Warning: coordinates for &#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> not found&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">lingtypology</span><span class="o">.</span><span class="n">glottolog</span><span class="o">.</span><span class="n">warnings</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span></div>

<div class="viewcode-block" id="LingMap.save"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save to file</span>

<span class="sd">        path: str</span>
<span class="sd">            Path to the output HTML file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_map</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="LingMap.render"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Renders the map returns it as HTML string&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_map</span><span class="p">()</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="LingMap.save_static"><a class="viewcode-back" href="../../maps.html#lingtypology.maps.LingMap.save_static">[docs]</a>    <span class="k">def</span> <span class="nf">save_static</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save as PNG (requires &#39;geckodriver&#39;)</span>
<span class="sd">        </span>
<span class="sd">        If fname is not given, returns the image as bytes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mappa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_map</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">png</span> <span class="o">=</span> <span class="n">mappa</span><span class="o">.</span><span class="n">_to_png</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;It seems that GeckoDriver is not installed.</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Method &quot;save_static&quot; requires it.</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;You could find it here:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;https://github.com/mozilla/geckodriver&#39;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">png</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">png</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LingTypology 0.8.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Michael Voronov.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>